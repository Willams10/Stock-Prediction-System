function calculatePrice(a){return 2>a?7*a:5*a}var App={Models:{},Collections:{},Views:{},Instances:{},Utils:{},Variables:{free_tier_limit:3,free_tier_groups_limit:0,free_trial_days:7,current_subscription:!1}};App.Models.Project=Backbone.Model.extend({defaults:{type:"project",color:!1,name:""}}),App.Models.SupplierProject=Backbone.Model.extend({defaults:{type:"project",color:!1,name:""}}),App.Utils.Typeaheads={},App.Utils.Typeaheads.Users=function(a){a=a||{};var b=_.map(App.Instances.UsersCollection.models,function(a){return{id:a.get("id"),name:a.get("name"),type:a.get("type")}});b.push({name:"Unassigned",id:0,type:null});var c=(a.selectCallback||!1,a.createCallback||!1,a.closeCallback||!1,a.object,!1);$(a.object).typeahead("destroy"),$(a.object).off("typeahead:render"),$(a.object).off("typeahead:selected"),$(a.object).off("change"),$(a.object).off("keydown"),a.remote&&(c={url:"/suppliers/asana/workspaces/"+a.workspace_id+"/users/typeahead?virtuals=true&query=%QUERY",wildcard:"%QUERY",filter:function(a){return $(".tt-loading").remove(),a},cache:!1});var d=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:b,remote:c,identify:function(a){return a.id}});$(a.object).typeahead({highlight:!0,minLength:2,autoselect:!0,hint:!1},{name:"users",display:"name",source:d,templates:{pending:function(a){return'<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>'}},hint:!1}).on("typeahead:rendered",function(b,c,d,e){var f=$(b.target).typeahead("val");$(a.object).parent().find(".tt-selectable:first").addClass("tt-cursor"),a.allowCreate&&(void 0==c||0==c.length)&&($(".tt-open .tt-new-vu").remove(),$(".tt-open .tt-dataset").append('<div class="tt-suggestion tt-selectable tt-new-vu">New Virtual User: <b>'+f+"</b></div>"),$(".tt-open .tt-dataset .tt-new-vu").on("click",function(b){a.createCallback(b,f)}))}).on("typeahead:asyncrequest",function(a,b,c){$(".tt-open .tt-loading").remove(),$(".tt-open .tt-dataset").append('<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>')}).on("typeahead:asyncreceive",function(a,b,c){$(".tt-open .tt-loading").remove()}).on("typeahead:selected",function(b,c,d){a.selectCallback(c),b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation()}).on("change",function(a,b,c){}).on("keydown",function(b,c){(27==b.keyCode||27==b.which)&&(a.createCallback=!1,b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation(),a.closeCallback(b)),13==b.keyCode&&$(a.object).parent().find(".tt-cursor").hasClass("tt-new-vu")&&a.createCallback(b,$(this).val())})},App.Utils.Typeaheads.Tags=function(a){a=a||{};var b=_.map(App.Variables.current_tags.models,function(a){return{id:a.get("id"),name:a.get("name")}}),c=(a.selectCallback||!1,a.createCallback||!1,a.closeCallback||!1,a.object,!1);$(a.object).typeahead("destroy"),$(a.object).off("typeahead:render"),$(a.object).off("typeahead:selected"),$(a.object).off("change"),$(a.object).off("keydown"),a.remote&&(c={url:"/suppliers/asana/workspaces/"+a.workspace_id+"/tags/typeahead?query=%QUERY",wildcard:"%QUERY",filter:function(a){return $(".tt-loading").remove(),a}});var d=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:b,remote:c,identify:function(a){return a.id}});$(a.object).typeahead({highlight:!0,minLength:2,autoselect:!0,hint:!1},{name:"tags",display:"name",source:d,templates:{pending:function(a){return'<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>'}},hint:!1}).on("typeahead:render",function(b,c,d,e){var f=$(b.target).typeahead("val");$(a.object).parent().find(".tt-selectable:first").addClass("tt-cursor"),a.allowCreate&&(void 0==c||0==c.length)&&$(".tt-open .tt-new-vu").length<=0&&$(".tt-open .tt-dataset").append('<div class="tt-suggestion tt-selectable tt-new-vu">New Tag: <b>'+f+"</b></div>")}).on("typeahead:asyncrequest",function(a,b,c){$(".tt-open .tt-loading").remove(),$(".tt-open .tt-dataset").append('<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>')}).on("typeahead:asyncreceive",function(a,b,c){$(".tt-open .tt-loading").remove()}).on("typeahead:selected",function(b,c,d){a.selectCallback(c),b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation()}).on("change",function(a,b,c){}).on("keydown",function(b,c){(27==b.keyCode||27==b.which)&&(a.createCallback=!1,b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation(),a.closeCallback(b)),13==b.keyCode&&$(a.object).parent().find(".tt-cursor").hasClass("tt-new-vu")&&a.createCallback(b,$(this).val())})},App.Utils.Typeaheads.Projects=function(a){a=a||{};var b=a.local||[],c=(a.selectCallback||!1,a.closeCallback||!1,a.object,!1);$(a.object).typeahead("destroy"),$(a.object).off("typeahead:render"),$(a.object).off("typeahead:selected"),$(a.object).off("change"),$(a.object).off("keydown"),a.remote&&(c={url:"/suppliers/asana/workspaces/"+a.workspace_id+"/projects/typeahead?query=%QUERY",wildcard:"%QUERY",filter:function(a){$(".tt-loading").remove();var b=_.filter(a,function(a){return"project"==a.type});return b}});var d=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:b,remote:c,identify:function(a){return a.supplier_project_id}});$(a.object).typeahead({highlight:!0,minLength:2,autoselect:!0,hint:!1},{name:"projects",display:"name",source:d,templates:{pending:function(a){return'<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>'}},hint:!1}).on("typeahead:render",function(a,b,c,d){}).on("typeahead:asyncrequest",function(a,b,c){$(".tt-open .tt-loading").remove(),$(".tt-open .tt-dataset").append('<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>')}).on("typeahead:asyncreceive",function(a,b,c){$(".tt-open .tt-loading").remove()}).on("typeahead:selected",function(b,c,d){a.selectCallback(c),b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation()}).on("change",function(a,b,c){}).on("keydown",function(b,c){(27==b.keyCode||27==b.which)&&(a.createCallback=!1,b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation(),a.closeCallback(b)),13==b.keyCode&&$(a.object).parent().find(".tt-cursor").hasClass("tt-new-vu")&&a.createCallback(b,$(this).val())})},App.Utils.Typeaheads.Tasks=function(a){a=a||{};var b=a.local||[];a.selectCallback||!1,a.closeCallback||!1,a.object;$(a.object).typeahead("destroy"),$(a.object).off("typeahead:render"),$(a.object).off("typeahead:selected"),$(a.object).off("change"),$(a.object).off("keydown");var c=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,local:b,identify:function(a){return a.id}});$(a.object).typeahead({highlight:!0,minLength:2,autoselect:!0,hint:!1},{name:"tasks",display:"name",source:c,templates:{pending:function(a){return'<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>'}},hint:!1}).on("typeahead:render",function(a,b,c,d){}).on("typeahead:asyncrequest",function(a,b,c){$(".tt-open .tt-loading").remove(),$(".tt-open .tt-dataset").append('<div class="tt-suggestion tt-loading">Loading <i class="fa fa-spin fa-spinner"></i></div>')}).on("typeahead:asyncreceive",function(a,b,c){$(".tt-open .tt-loading").remove()}).on("typeahead:selected",function(b,c,d){a.selectCallback(c),b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation()}).on("change",function(a,b,c){}).on("keydown",function(b,c){(27==b.keyCode||27==b.which)&&(a.createCallback=!1,b.stopPropagation(),b.preventDefault(),b.stopImmediatePropagation(),a.closeCallback(b)),13==b.keyCode&&$(a.object).parent().find(".tt-cursor").hasClass("tt-new-vu")&&a.createCallback(b,$(this).val())})},App.Models.User=Backbone.Model.extend({}),App.Collections.Projects=Backbone.Collection.extend({model:App.Models.Project,url:URL+"/projects",cache:{ttl:0},sortOrder:{project:"2",workspace:"2",group:0},comparator:function(a){var b="";switch(a.get("type")){case"project":ws=a.get("workspace")?a.get("workspace").id:0,b=this.sortOrder[a.get("type")]+"-"+ws+"-1";break;case"workspace":ws=a.get("supplier_project_id"),("undefined"==typeof a.get("subtype")||"undefined"!=typeof a.get("subtype")&&"team"!=a.get("subtype"))&&(b=this.sortOrder[a.get("type")]+"-"+ws+"-0"),"undefined"!=typeof a.get("subtype")&&"team"==a.get("subtype")&&(b=this.sortOrder.group+"-"+ws+"-0");break;case"group":b=this.sortOrder[a.get("type")]+"-0"}return String(b+a.get("name"))},stats:function(){return{projects:this.where({type:"project"}).length+this.where({type:"workspace"}).length,groups:this.where({type:"group"}).length}},_filter:function(a){a=a||{};var b=a.query||"";return this.filter(function(a){return a.get("name").toLowerCase().indexOf(b.toLowerCase())>-1})}}),App.Collections.SubscriptionUsers=Backbone.Collection.extend({model:App.Models.User,initialize:function(a){this.supplier=a.supplier},url:function(){return"/subscriptions/current/users"}}),App.Collections.SupplierTeams=Backbone.Collection.extend({model:Backbone.Model,initialize:function(a,b){this.url=URL+"/suppliers/"+b.supplier+"/workspaces/"+b.workspace_id+"/teams"},comparator:function(a){return a.get("name")}}),App.Collections.SupplierWorkspaces=Backbone.Collection.extend({model:Backbone.Model,initialize:function(a,b){this.url="/suppliers/"+b.supplier+"/workspaces"},comparator:function(a){return a.get("name")}}),App.Collections.SupplierProjects=Backbone.Collection.extend({model:App.Models.SupplierProject,initialize:function(a,b){this.supplier=b.supplier,this.url=URL+"/suppliers/"+b.supplier+"/projects"},_fetch:function(a){a||(a={}),this.url=App.Instances.SupplierProjectsView.workspacesCollection.url+"/"+a.workspace_id+"/projects",a.success||(a.success=function(){}),a.error||(a.error=function(){});var b=this.fetch(a);setTimeout(function(){b.readyState>0&&b.readyState<4&&(console.log("aborting"),b.abort())},7e3)},_fetchTypeahead:function(a){this.url=URL+"/suppliers/"+this.supplier+"/workspaces/"+a.workspace_id+"/projects/typeahead?query="+a.query,a||(a={}),a.success||(a.success=function(){}),a.error||(a.error=function(){}),this.fetch(a)},_filter:function(a){var b=a.query||"";return a.groups||a.teams?a.teams?(console.log("Filtering by teams"),this.filter(function(a){return a.get("name").toLowerCase().indexOf(b.toLowerCase())>-1&&"group"==a.get("type")&&"team"==a.get("subtype")})):this.filter(function(a){return a.get("name").toLowerCase().indexOf(b.toLowerCase())>-1&&"group"==a.get("type")&&"team"!=a.get("subtype")}):this.filter(function(a){return a.get("name").toLowerCase().indexOf(b.toLowerCase())>-1&&"group"!=a.get("type")&&"team"!=a.get("subtype")})},sortOrder:{project:2,workspace:1,group:0},comparator:function(a){var b=a.get("team")?a.get("team").name:0;return ws=a.get("workspace")?a.get("workspace").id:0,[this.sortOrder[a.get("type")],ws,b,a.get("name")]}}),App.Collections.Suppliers=Backbone.Collection.extend({model:Backbone.Model,url:URL+"/suppliers",comparator:function(a){a.get("workspace");return a.get("workspace")&&a.get("workspace").id?a.get("workspace").id:void 0}}),App.Collections.Users=Backbone.Collection.extend({model:App.Models.User,initialize:function(){this.fetching=!1},url:function(){return"/projects/"+App.Variables.project_id+"/users"},_fetch:function(a){var b=this;a||(a={}),a.success||(a.success=function(){}),a.error||(a.error=function(){});var c=a.success,d=a.error;this.fetching=!0,NProgress.configure({parent:"#gantt-pane",trickleRate:"0.1"}),NProgress.status||NProgress.start(),a.success=function(){"workload"==App.Variables.active_view&&NProgress.done(),b.fetching=!1,c()},a.error=function(){d()},a.remove=!1,this.fetch(a)},_filter:function(a){a=a||{};var b=a.query||"";return this.filter(function(c){"undefined"==typeof c.get("belongs_to_project")&&c.set({belongs_to_project:!1},{silent:!0});var d="undefined"!=typeof a.belongs_to_project?c.get("belongs_to_project")==a.belongs_to_project:!0;return c.get("name").toLowerCase().indexOf(b.toLowerCase())>-1&&d})}}),App.Collections.WorkspaceUsers=Backbone.Collection.extend({model:App.Models.User,initialize:function(a){this.fetching=!1,this.supplier=a.supplier},url:function(){return"/workspace/"},_fetch:function(a){a||(a={}),a.success||(a.success=function(){}),a.error||(a.error=function(){}),this.url="/workspaces/"+a.workspace_id+"/users";var b=a.success,c=a.error;a.success=function(){b()},a.error=function(){c()},this.fetch(a)},_fetchTypeahead:function(a){this.url="/suppliers/"+this.supplier+"/workspaces/"+a.workspace_id+"/users/typeahead?query="+a.query,a||(a={}),a.success||(a.success=function(){}),a.error||(a.error=function(){}),this.fetch(a)},_filter:function(a){a=a||{};var b=a.query||"";return this.filter(function(a){return a.get("name").toLowerCase().indexOf(b.toLowerCase())>-1})}}),App.Views.Subscription=Backbone.View.extend({el:"#subscription-modal",welcomeTemplate:JST["react-bridge/subscription-welcome"],teamTemplate:JST["react-bridge/subscription-team"],memberTemplate:JST["react-bridge/subscription-member"],reduceProjectsTemplate:JST["react-bridge/subscription-reduce-projects"],events:{"click .btn-success":"download","click .generate-days":"generateDays","click .generate-weeks":"generateWeeks","change #subscription-workspace":"selectWorkspace","click #subscription-workspace-users li":"addUser","click #subscription-users .btn-remove":"removeUser","keyup #subscription-workspace-users-search":"searchUsers","click .btn-edit-subscription":"subscriptionEditor","click .billing-cycle-selector li":"changeBillingCycle","click .btn-go-personal":"goPersonal","click .btn-go-team":"goTeam","click .btn-reactivate-subscription":"reactivateSubscription","click .btn-cancel-subscription":"cancelSubscription","click .btn-change-subscription":"changeSubscription","click .payments-link":"paymentsLink","click .btn-close":"closeWindow","click .btn-reduce-projects":"reduceProjects","click .btn-close-reduce-projects":"closeReduceProjects","click .btn-success-reduce-projects":"closeWindow","click .btn-disconnect-project":"disconnectProject","click .btn-update-credit-card":"updateCreditCard","click .btn-update-billing-information":"billingInformationModal","click .btn-close-billing-information":"closeBillingInformation","click .btn-save-billing-information":"saveBillingInformation","click .btn-add-team":"team","click .btn-skip-payments":"skipPayments","click .hide-notification":"hideNotification","click .btn-close-welcome":"closeWindow"},initialize:function(){var a=this;this.getCurrentSubscription(),setInterval(function(){a.getCurrentSubscription()},27e5),this.workspacesCollection||(this.workspacesCollection=new App.Collections.SupplierWorkspaces([],{supplier:"asana"})),this.workspacesCollection.on("reset",this.renderWorkspaces,this),this.workspaceUsersCollection||(this.workspaceUsersCollection=new App.Collections.WorkspaceUsers({supplier:"asana"})),this.workspaceUsersCollection.on("reset",this.renderWorkspaceUsers,this),this.workspaceUsersCollection.on("add",this.renderWorkspaceUsers,this),this.workspaceUsersCollection.on("remove",this.renderWorkspaceUsers,this),this.subscriptionUsersCollection||(this.subscriptionUsersCollection=new App.Collections.SubscriptionUsers({supplier:"asana"})),this.subscriptionUsersCollection.on("reset",this.renderSubscriptionUsers,this),this.subscriptionUsersCollection.on("add",this.renderSubscriptionUsers,this),this.subscriptionUsersCollection.on("remove",this.renderSubscriptionUsers,this),this.subscription=$.Deferred(),this.billingCycle="monthly",this.users_amount=5,this.public_stripe_key="pk_live_uYwf838Tpa41dJ2x4nPUdSeZ",("applocal1.instagantt.com"==window.location.hostname||"localhost"==window.location.hostname)&&(this.public_stripe_key="pk_test_B0IlqFQVbczXJZFbhoIWh4zF")},getCurrentSubscription:function(){var a=this;$(".billing-team-link").show(),$.get("/subscriptions/current",function(b){var c=b;c&&c.id?c.suspended?(App.Variables.current_subscription=c,a.users_amount=c.max_users,"month"==c.frequency?a.billingCycle="monthly":"year"==c.frequency&&(a.billingCycle="anual"),a.pushIntercom({paid_account:!0,suspended:!0,price:b.price,frequency:b.frequency,subscription_id:b.id,subscription_reference:b.subscription_reference}),store&&"standalone"!=store.user.type&&a.suspendedModal()):(App.Variables.current_subscription=c,a.users_amount=c.max_users,"/pro-monthly"==c.frequency?a.billingCycle="monthly":"/pro-anual"==c.frequency&&(a.billingCycle="anual"),a.subscriptionUsersCollection.reset(c.members),a.pushIntercom({paid_account:!0,price:b.price,frequency:b.frequency,subscription_id:b.id,subscription_reference:b.subscription_reference})):(a.checkFreeLimit(),a.pushIntercom({paid_account:!1})),App.Variables.current_subscription&&$("#subscription-account-manager").html(App.Variables.current_subscription.owner.name),a.subscription.resolve()}).error(function(){a.checkFreeLimit()})},pushIntercom:function(a){window.Intercom("update",a),$crisp&&a.paid_account&&$crisp.push(["set","session:segments",[["paid-account"]]]),"undefined"!=typeof HelpCrunch&&HelpCrunch("updateUserData",a)},checkFreeLimit:function(){var a=this;return console.log("Checking free limit"),store&&store.user&&"standalone"==store.user.type?void $(".billing-team-link").hide():void(App.Variables.current_subscription||(router.projects.done(function(){router.user.done(function(){var b=(store.projects.models.length,store.projects.stats()),c=moment().diff(moment(store.user.created_at),"days");c>=App.Variables.free_trial_days&&(b.projects>App.Variables.free_tier_limit||b.groups>App.Variables.free_tier_groups_limit)&&a.upgradeModal()})}),$(".user-options .upgrade").show(),$(".billing-team-link").hide()))},upgradeModal:function(){var a=this;console.log("You have exceeded the number of projects included in the free plan "),setTimeout(function(){$(a.el).modal(),$(a.el).load("/subscriptions/limit")},300),store.uistate.trackAnalytics("Checkout Asana Free Tier Exceeded Modal")},suspendedModal:function(){var a=this;console.log("Your account has been suspended due to payment inactivity"),setTimeout(function(){$(a.el).modal(),$(a.el).load("/subscriptions/suspended",function(){App.Variables.current_subscription&&$("#subscription-account-manager").html(App.Variables.current_subscription.owner.name)})},300)},welcome:function(){$(this.el).modal("show"),$(this.el).html(this.welcomeTemplate()),1==App.Variables.current_subscription.max_users&&($(".btn-add-team").hide(),$(".add-team-title").hide()),$crisp&&$crisp.push(["set","session:event",[[["purchase"]]]])},team:function(){var a=this;this.subscription.done(function(){App.Variables.current_subscription.is_owner?($(a.el).modal("show"),$(a.el).html(a.teamTemplate()),$("#subscription-workspace-loading").show(),$("#subscription-workspace").hide(),a.workspacesCollection.fetch({reset:!0}),a.subscriptionUsersCollection.trigger("reset"),a.renderPayments(),a.renderFailedPayments()):($(a.el).modal("show"),$(a.el).html(a.memberTemplate()),App.Variables.current_subscription&&$("#subscription-account-manager").html(App.Variables.current_subscription.owner.name))})},renderFailedPayments:function(){App.Variables.current_subscription.failed_payments.length>0&&$("#failed-payment-alert").show()},renderPayments:function(){var a=this;$("#payment-history tbody",a.el).html(""),_.each(App.Variables.current_subscription.payments,function(b){b.total<0?$("#payment-history tbody",a.el).append("<tr><td>Credit Adjustment (no invoice)</td><td>"+moment(1e3*(b.date||b.created)).format("DD MMM YYYY HH:mm:ss")+"</td><td style='text-align:right'>$"+b.total/100+"</td><td><a href='/subscriptions/current/invoice/"+b.id+"' target='_blank'>Print</a></td></tr>"):$("#payment-history tbody",a.el).append("<tr><td>"+(b.number||b.id)+"</td><td>"+moment(1e3*(b.date||b.created)).format("DD MMM YYYY HH:mm:ss")+"</td><td style='text-align:right'>$"+b.total/100+"</td><td><a href='/subscriptions/current/invoice/"+b.id+"' target='_blank'>Print</a></td></tr>")})},renderWorkspaces:function(){$("#subscription-workspace").html("<option value=0 disabled>Choose a Workspace/Organization</option>"),$("#subscription-workspace-loading").hide(),$("#subscription-workspace").show(),this.workspacesCollection.each(function(a){$("#subscription-workspace").append("<option value='"+a.get("supplier_workspace_id")+"'>"+a.get("name")+"</option>")})},selectWorkspace:function(){$("#subscription-workspace-users-search").val(""),$("#subscription-workspace-users-search").focus()},renderWorkspaceUsers:function(){var a=this,b="";$("#subscription-workspace-loading").hide(),$("#subscription-workspace-users").html(""),_.each(this.workspaceUsersCollection._filter({query:b}),function(b){var c=a.subscriptionUsersCollection.get(b.get("id"));if(!c){var d=b.get("name").split("'s tasks")[0];$("#subscription-workspace-users").append("<li data-id='"+b.get("id")+"'><div class='upgrade pull-right'><i class='fa fa-star'></i>Upgrade</div>"+d+"</li>")}})},renderSubscriptionUsers:function(){$("#subscription-users").html(""),this.subscriptionUsersCollection.each(function(a){var b=a.get("id")?a.get("id"):a.get("user_id"),c="<div class='upgrade btn-remove btn btn-danger btn-small pull-right'  data-id='"+b+"'><i class='fa fa-trash'></i> Remove </div>";App.Variables.current_subscription.owner.asana_account.id==a.get("id")&&(c=""),$("#subscription-users").append("<li>"+c+a.get("name")+"</li>")}),this.renderCounters()},addUser:function(a){if(this.subscriptionUsersCollection.models.length==App.Variables.current_subscription.max_users)return alert("You have no more users available on your plan. Please upgrade"),!1;var b=$(a.currentTarget).attr("data-id"),c=this.workspaceUsersCollection.findWhere({id:String(b)});this.subscriptionUsersCollection.create({user_id:b,name:c.get("name").split("'s tasks")[0]}),this.workspaceUsersCollection.remove(c)},removeUser:function(a){var b=confirm("Are you sure?");if(b){var c=$(a.currentTarget).attr("data-id"),d=this.subscriptionUsersCollection.get(c);d&&d.destroy(),this.selectWorkspace()}},searchUsers:function(a){var b=$(a.currentTarget).val(),c=$("#subscription-workspace").val();this.usersTypeaheadDebounced({instance:this,query:b,workspace_id:c})},usersTypeaheadDebounced:_.debounce(function(a){var b=a.instance,c=a.query,d=a.workspace_id;$("#subscription-workspace-loading").show(),b.workspaceUsersCollection._fetchTypeahead({query:c,workspace_id:d,reset:!0})},300),renderCounters:function(){$(".subscription-users-column-right .counter",this.el).html(this.subscriptionUsersCollection.models.length+"/"+App.Variables.current_subscription.max_users),$("#current-subscription-max-users",this.el).html(App.Variables.current_subscription.max_users),$("#current-subscription-used-users",this.el).html(this.subscriptionUsersCollection.models.length),$("#current-subscription-price",this.el).html(App.Variables.current_subscription.price),$("#current-subscription-billing-cycle",this.el).html(App.Variables.current_subscription.frequency);for(var a=1;100>=a;a++)$("#edit-subscription-dropdown").append("<option value='"+a+"'>"+a+"</option>")},subscriptionEditor:function(){"none"==$("#subscription-editor").css("display")?($("#subscription-editor").show(),$("#edit-subscription-dropdown option[value="+this.users_amount+"]").attr("selected","true")):$("#subscription-editor").hide()},changeBillingCycle:function(){$(".billing-cycle-selector .monthly").hasClass("active")?($(".billing-cycle-selector .monthly").removeClass("active"),$(".billing-cycle-selector .anual").addClass("active"),this.billingCycle="anual"):($(".billing-cycle-selector .anual").removeClass("active"),$(".billing-cycle-selector .monthly").addClass("active"),this.billingCycle="monthly"),this.renderPrices()},renderPrices:function(a){a&&(this.users_amount=a);var b=this.users_amount,c=calculatePrice(b),d=10*c,e=calculatePrice(1),f=10*e;if("anual"==this.billingCycle)var g=d,h=f,i="year";else var g=c,h=e,i="month";$(".calculated-price").html(g),$(".single-calculated-price").html(h),$(".billing-cycle").html(i)},goPersonal:function(a){$(a.currentTarget).addCog(),this.buy(1,this.billingCycle,function(){$(a.currentTarget).removeCog()})},goTeam:function(a){$(a.currentTarget).addCog(),this.buy(this.users_amount,this.billingCycle,function(){$(a.currentTarget).removeCog()})},buy:function(a,b,c){"anual"==b&&(b="yearly"),this.buyStripe(a,b,c)},reactivateSubscription:function(a){$(a.currentTarget).addCog(),this.buy(this.users_amount,this.billingCycle,function(){$(a.currentTarget).removeCog()})},cancelSubscription:function(a){var b=confirm("Are you sure to cancel your subscription?");return b?(store.uistate.current_modal="COVID",store.uistate.current_modal_options={selected_subscription:App.Variables.current_subscription},void this.closeWindow()):!1},changeSubscription:function(a){var b=confirm("By increasing your users amount, we will charge you the additional cost for each user. By reducing them, we will decrease your bill");if(!b)return!1;var c=$("#edit-subscription-dropdown").val();if(console.log(c),console.log(this.subscriptionUsersCollection.models.length),parseInt(c)<this.subscriptionUsersCollection.models.length)return alert("You have more members than your new subscription size. Please remove members first"),!1;if(parseInt(c)==this.users_amount)return this.subscriptionEditor(),!1;var d=$(a.currentTarget);d.html("<i class='fa fa-spin fa-spinner'></i>"),d.attr("disabled","true"),$.ajax({type:"put",url:"/subscriptions/current",data:{quantity:parseInt(c)}}).done(function(){window.location.reload()})},paymentsLink:function(){window.open(App.Variables.current_subscription.customer_url)},closeWindow:function(){$(this.el).modal("hide"),window.location.hash=""},reduceProjects:function(){$(this.el).modal("show"),$(this.el).html(this.reduceProjectsTemplate()),$(".disconnect-projects-list").html(""),router.projects.done(function(){store.projects.models.forEach(function(a){if("group"==a.type)var b="fa-folder-open";else if("workspace"==a.type)var b="fa-user";else{if("project"!=a.type)return;var b="fa-list"}$(".disconnect-projects-list").append("<li><a href='#'><button class='pull-right btn btn-danger btn-small btn-disconnect-project' data-id='"+a.id+"'><i class='fa fa-trash'></i> Disconnect</button><i class='fa fa-fw "+b+"'></i>"+a.name+"</a></li>")});var a=store.projects.stats(),b=a.projects>App.Variables.free_tier_limit?a.projects-App.Variables.free_tier_limit:0,c=a.groups>App.Variables.free_tier_groups_limit?a.groups-App.Variables.free_tier_groups_limit:0;$("#projects-to-be-removed").html(b),$("#groups-to-be-removed").html(c),b>0||c>0?($(".btn-success-reduce-projects").hide(),$(".btn-close-reduce-projects").show()):($(".btn-close-reduce-projects").hide(),$(".btn-success-reduce-projects").show())})},closeReduceProjects:function(){this.checkFreeLimit()},disconnectProject:function(a){var b=$(a.currentTarget),c=b.attr("data-id"),d=store.projects.get(c);d&&d.destroy(),this.reduceProjects()},upgrade:function(){$(this.el).modal(),$(this.el).load("/subscriptions/upgrade"),store.uistate.trackAnalytics("Checkout Asana Upgrade Intent")},buyStripe:function(a,b,c){c=c||function(){};var d=this;"monthly"==b?12*d.plan(a,b).amount:d.plan(a,b).amount;return void fetch("/subscriptions/intent",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({plan:d.plan(a,b).plan_name,quantity:a,workbook_ids:[],members:[]})}).then(function(a){a.json().then(function(a){window.location.href=a.url})})},updateCreditCard:function(a){$(a.currentTarget).addCog();var b=App.Variables.current_subscription;return void fetch("/subscriptions/"+b.id+"/update_card",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"}).then(function(a){a.json().then(function(a){a.url&&(window.location.href=a.url)})})},plan:function(a,b){b=b||"monthly";var c=0,d="";return"monthly"==b?1==a?(c=7,d="single-user-monthly"):(c=5*a,d="team-monthly"):1==a?(c=70,d="single-user-yearly"):(c=5*a*10,d="team-yearly"),{amount:c,plan_name:d}},showNotification:function(a){$("#processing-payment-modal").modal(),$("#processing-payment-modal .modal-body").html(a)},hideNotification:function(a){$("#processing-payment-modal").modal("hide")},skipPayments:function(){$(this.el).modal("hide"),window.location.hash=""},billingInformationModal:function(){$(".billing-information-modal").modal()},closeBillingInformation:function(){$(".billing-information-modal").modal("hide")},saveBillingInformation:function(a){$(a.currentTarget).addCog();var b=this,c={billing_name:$(".billing-name",this.el).val(),billing_address:$(".billing-address",this.el).val(),billing_details:$(".billing-details",this.el).val()};$.ajax({url:"/subscriptions/current/billing_information",type:"PUT",data:c,success:function(){$(a.currentTarget).removeCog(),b.closeBillingInformation()}})}}),App.Views.SupplierProjects=Backbone.View.extend({el:"#import-projects",events:{"click .create-group-button":"groupCreator","click .create-users-group-button":"usersGroupCreator","click #create-group ul .icon-trash":"deleteTemporalProjectFromGroup","click .btn-create-group":"createGroup","click .btn-cancel-create-group":"cancelCreateGroup","click .btn-create-team":"createGroup","click .btn-cancel-create-team":"cancelCreateGroup","keyup .search":"filter","click .nav-pills li":"toggleTypes","click li.workspace":"selectWorkspace","click .go-back":"renderWorkspaces","keyup #supplier-projects-typeahead input":"projectsTypeahead"},initialize:function(a){_.bindAll(this,"error"),$(".providers",this.el).html(""),$("#import-projects .nav-pills li").removeClass("active"),$("#import-projects .nav-pills li.by-project").addClass("active"),$("#import-projects .search").val(""),this.supplier=a.supplier,this.defaultView=a.defaultView||"single-project",this.query="",this.by_group=!1,this.by_team=!1,this.type="projects",this.projectsCollection=new App.Collections.SupplierProjects([],{supplier:a.supplier}),this.workspacesCollection||(this.workspacesCollection=new App.Collections.SupplierWorkspaces([],{supplier:a.supplier})),this.usersCollection||(this.usersCollection=new App.Collections.WorkspaceUsers({supplier:a.supplier})),0==this.workspacesCollection.models.length?(this.workspacesCollection.fetch({reset:!0,success:this.loading,error:this.error}),this.loading()):this.renderWorkspaces(),this.workspacesCollection.on("reset",this.renderWorkspaces,this),this.workspacesCollection.on("change",this.renderWorkspaces,this),this.workspacesCollection.on("remove",this.renderWorkspaces,this),this.projectsCollection.on("reset",this.render,this),this.projectsCollection.on("change",this.render,this),this.projectsCollection.on("remove",this.render,this),this.usersCollection.on("reset",this.renderUsers,this),this.usersCollection.on("change",this.renderUsers,this),this.usersCollection.on("remove",this.renderUsers,this)},selectWorkspace:function(a,b){if($(".create-group-button").show(),$(".topbar",this.el).show(),$(".projects",this.el).html(""),$(".nav-pills li",this.el).removeClass("active"),$(".nav-pills li.by-project",this.el).addClass("active"),!b)var c=$(a.currentTarget),b=c.attr("data-id");switch(this.workspace_id=b,this.usersCollection.reset([],{silent:!0}),$(".modal-header",this.el).html("<a href='javascript:void(0);' class='go-back label label-info'><i class='fa fa-caret-left'></i> Back</a> Connect your projects</b>"),this.defaultView){case"projects-group":return void $(".topbar .by-group",this.el).click();case"users-group":return void $(".topbar .by-team",this.el).click();case"single-user":return void $(".topbar .by-user",this.el).click()}this.browseByProject()},browseByProject:function(){var a=this;this.loading(),this.projectsCollection._fetch({workspace_id:a.workspace_id,reset:!0,success:a.loading,error:function(){a.typeaheads()}})},renderWorkspaces:function(){$(".providers",this.el).html(""),
$(".projects",this.el).html(""),$(".providers",this.el).hide(),$(".projects",this.el).show(),$(".create-group-button").show(),$(".topbar",this.el).hide(),$(".supplier-typeahead",this.el).hide(),$(".modal-header",this.el).html("Browse your projects by workspace");var a=!1,b=0;this.workspacesCollection.each(function(c){b++,$(".projects",this.el).append($('<li class="workspace" data-id="'+c.get("supplier_workspace_id")+'"><a href="javascript:void(0);"><div class="pull-right"><i class="fa fa-fw fa-chevron-right"></i> </div><i class="fa fa-building-o fa-fw"></i> '+c.get("name")+"</a></li>")),a=c}),1==b&&a&&this.selectWorkspace(null,a.get("supplier_workspace_id"))},typeaheads:function(){$(".loading",this.el).hide(),$("#import-projects-content > ul.nav-tabs.topbar").show(),$(".supplier-typeahead",this.el).show(),$(".supplier-typeahead input",this.el).val(""),$(".search",this.el).hide(),this.fetch_type="typeaheads"},render:function(){$(".providers",this.el).html(""),$(".projects",this.el).html(""),$(".providers",this.el).hide(),$(".projects",this.el).show(),$(".create-group-button").show(),$(".topbar",this.el).show();var a=!1;this.populateGroups(),_.each(this.projectsCollection._filter({query:this.query,groups:this.by_group,teams:this.by_team}),function(b){if(b.get("team")&&b.get("team").id!=a){var c=b.get("team");a=c.id,$(".projects",this.el).append($('<li class="team"><i class="fa fa-users"></i> '+c.name+"</li>"))}var d=new App.Views.SupplierProjectSingle({model:b});$(".projects",this.el).append(d.render().el)}),0==this.projectsCollection.models.length,this.by_group?$(".projects",this.el).append($('<li><a href=javascript:void(0); class="create-group-button"><i class="fa fa-plus fa-fw"></i> Create a new group of Projects</li>')):this.by_team&&$(".projects",this.el).append($('<li><a href=javascript:void(0); class="create-users-group-button"><i class="fa fa-plus fa-fw"></i> Create a new Team</li>'))},populateGroups:function(){var a=App.Instances.ProjectsCollection.filter(function(a){return"group"==a.get("type")});this.projectsCollection.add(a)},projectsTypeahead:function(a){var b=$(a.currentTarget),c=b.val();if(c!=this.typeahead_query){this.typeahead_query=c;"projects"==this.type&&this.projectsTypeaheadDebounced({instance:this,query:c,workspace_id:this.workspace_id}),"users"==this.type&&this.usersTypeaheadDebounced({instance:this,query:c,workspace_id:this.workspace_id})}},projectsTypeaheadDebounced:_.debounce(function(a){var b=a.instance,c=a.query,d=a.workspace_id;$(".projects",b.el).html("<li><i class='fa fa-spinner fa-spin'></i> Connecting to Asana...</li>"),b.projectsCollection._fetchTypeahead({query:c,workspace_id:d,reset:!0})},300),usersTypeaheadDebounced:_.debounce(function(a){var b=a.instance,c=a.query,d=a.workspace_id;$(".projects",b.el).html("<li><i class='fa fa-spinner fa-spin'></i> Connecting to Asana...</li>"),b.usersCollection._fetchTypeahead({query:c,workspace_id:d,reset:!0})},300),renderUsers:function(){$(".providers",this.el).html(""),$(".projects",this.el).html(""),$(".providers",this.el).hide(),$(".projects",this.el).show(),$(".create-group-button").show(),$(".topbar",this.el).show(),_.each(this.usersCollection._filter({query:this.query}),function(a){var b=new App.Views.SupplierProjectSingle({model:a});$(".projects",this.el).append(b.render().el)}),0==this.projectsCollection.models.length},filter:function(){this.query=$(".search",this.el).val(),"users"==this.type?this.renderUsers():this.render()},toggleTypes:function(a){var b=$(a.currentTarget);if(this.query="",b.hasClass("by-group"))$(".nav-pills li",this.el).removeClass("active"),$(".nav-pills li.by-group",this.el).addClass("active"),this.type="groups",this.by_team=!1,this.by_group=!0,$(".supplier-typeahead").hide();else if(b.hasClass("by-project"))$(".nav-pills li",this.el).removeClass("active"),$(".nav-pills li.by-project",this.el).addClass("active"),this.type="projects",this.by_team=!1,this.by_group=!1,$(".supplier-typeahead input").val(""),"typeaheads"!=this.fetch_type?0==this.projectsCollection.models.length?this.browseByProject():this.render():$(".supplier-typeahead").show();else{if(!b.hasClass("by-team"))return $(".nav-pills li",this.el).removeClass("active"),$(".nav-pills li.by-user",this.el).addClass("active"),$(".projects",this.el).html(""),this.type="users",this.by_team=!1,this.by_group=!1,"typeaheads"!=this.fetch_type?0==this.usersCollection.models.length?(this.loading(),this.usersCollection._fetch({workspace_id:this.workspace_id,success:this.loading,reset:!0})):this.renderUsers():(this.renderUsers(),$(".supplier-typeahead").show(),$(".supplier-typeahead input").val("")),$("#import-projects .search").val(""),void(this.query="");$(".nav-pills li",this.el).removeClass("active"),$(".nav-pills li.by-team",this.el).addClass("active"),this.type="team",this.by_team=!0,this.by_group=!1,$(".supplier-typeahead input").val("")}$("#import-projects .search").val(""),this.render()},loading:function(){$("#import-projects-content > ul.nav-tabs.topbar").toggle(),$(".loading",this.el).toggle()},error:function(a,b){var c,d=this;$(".projects",this.el).html("");try{c=JSON.parse(b.responseText)}catch(e){}if($(".loading",this.el).toggle(),401==b.status){if("trello"==this.supplier){$(".projects",this.el).append($('<li style="text-align:center;"><p><strong>You haven\'t authorized Trello to work with Ganttly, or the access has been revoked</strong></p></li>'));var f=$('<li style="text-align:center"><button class="btn btn-success btn-small">Connect my Trello account with Ganttly</button></li>');f.on("click",function(){d.request_trello_auth(c.auth_url)}),$(".projects",this.el).append(f)}if("asana"==this.supplier){$(".projects",this.el).append($('<li style="text-align:center;"><p><strong>Authorize asana</strong></p></li>'));var f=$('<li style="text-align:center"><div style="width:300px;margin:0 auto;"><div class="">&nbsp;<button class="btn btn-primary">Connect with Asana</button></div></div></li>');f.on("click","button",function(){window.location="/asana/connect"}),$(".projects",this.el).append(f)}}500==b.status&&$(".projects",this.el).append("There seems to be a problem with your Asana account. Please contact support."),503==b.status&&$("#import-projects").modal("hide")},request_trello_auth:function(a){var b=this,c=window.open(a,"popup","width=500,height=600");window.addEventListener("message",function(a){c.close(),$.ajax({url:"/suppliers",data:JSON.stringify({name:"trello",key:a.data}),success:function(a){b.loading(),b.projectsCollection.fetch({success:b.loading,error:b.error,reset:!0})},contentType:"application/json",type:"post"})},!1)},request_asana_auth:function(a){var b=this;$(".projects",this.el).html(""),$.ajax({url:"/suppliers",data:JSON.stringify({name:"asana",key:a}),success:function(a){b.loading(),b.projectsCollection.fetch({success:b.loading,error:b.error,reset:!0})},contentType:"application/json",type:"post"})},groupCreator:function(){var a=this,b=App.Variables.group_max_projects;this.new_group=[],$("#import-projects-content").hide(),$("#create-group").show(),$("#create-group-name").val(""),$("#create-group ul").html(""),$("#create-group .progress .bar",this.el).css({width:"0%"}),$(".group-max-projects-text").html(b);var a=this;App.Utils.Typeaheads.Projects({object:$(".typeahead-group",a.el),workspace_id:a.workspace_id,local:[],remote:!0,allowCreate:!1,selectCallback:function(c){if(a.by_group){var d=c.supplier_project_id;if(-1!=_.map(a.new_group,function(a){return a.supplier_project_id}).indexOf(d)||a.new_group.length>=b)return;var e=c}else{var f=c.user_id;if(-1!=_.map(a.new_group,function(a){return a.user_id}).indexOf(f)||a.new_group.length>=b)return;var e=c}a.new_group.push(e),a.groupCreatorRenderCurrentProjects(),$(".typeahead-group",a.el).typeahead("val","")},createCallback:function(a,b){},closeCallback:function(a){}})},usersGroupCreator:function(){var a=this,b=App.Variables.group_max_projects;this.new_group=[],$("#import-projects-content").hide(),$("#create-team").show(),$("#create-team-name").val(""),$("#create-team ul").html(""),$("#create-team .progress .bar",this.el).css({width:"0%"}),$(".group-max-projects-text").html(b);var a=this;App.Utils.Typeaheads.Users({object:$(".typeahead",a.el),workspace_id:a.workspace_id,local:[],remote:!0,allowCreate:!1,selectCallback:function(c){var d=c.id;if(!(-1!=_.map(a.new_group,function(a){return a.user_id}).indexOf(d)||a.new_group.length>=b)){console.log(c);var e=c;a.new_group.push(e),a.groupCreatorRenderCurrentUsers(),$(".typeahead",a.el).typeahead("val","")}},createCallback:function(a,b){},closeCallback:function(a){}})},throttledTypeahead:_.debounce(function(a,b,c){$(".typeahead-loading").show(),jQuery.ajax({type:"GET",url:"/suppliers/asana/workspaces/"+c.workspace_id+"/projects/typeahead?query="+a,cache:!1,success:function(a){$(".typeahead-loading").hide();var c=a;window.bondObjs={},window.bondNames=[],_.each(c,function(a,b){if(a.supplier_project_id){var c=a.name+" ("+a.supplier_project_id+")";window.bondNames.push(c),window.bondObjs[c]=a}}),b(window.bondNames)}})},300),throttledUsersTypeahead:_.debounce(function(a,b,c){$(".typeahead-loading").show(),jQuery.ajax({type:"GET",url:"/suppliers/asana/workspaces/"+c.workspace_id+"/usersTasks/typeahead?query="+a,cache:!1,success:function(a){$(".typeahead-loading").hide();var c=a;window.bondObjs={},window.bondNames=[],_.each(c,function(a,b){if(a.supplier_project_id){var c=a.name+" ("+a.supplier_project_id+")";window.bondNames.push(c),window.bondObjs[c]=a}}),b(window.bondNames)}})},300),groupCreatorRenderCurrentProjects:function(){var a=App.Variables.group_max_projects;$("#create-group ul",this.el).html(""),$("#create-group .progress .bar",this.el).css({width:this.new_group.length/a*100+"%"}),_.each(this.new_group,function(a){$("#create-group ul",this.el).append($('<li><span><i class="icon icon-trash" data-id="'+a.supplier_project_id+'"></i></span> '+a.name+"</li>"))})},groupCreatorRenderCurrentUsers:function(){var a=App.Variables.group_max_projects;$("#create-team ul",this.el).html(""),$("#create-team .progress .bar",this.el).css({width:this.new_group.length/a*100+"%"}),_.each(this.new_group,function(a){$("#create-team ul",this.el).append($('<li><span><i class="icon icon-trash" data-id="'+a.user_id+'"></i></span> '+a.name+"</li>"))})},deleteTemporalProjectFromGroup:function(a){if(this.by_group){var b=$(a.target).attr("data-id");this.new_group=_.reject(this.new_group,function(a){return a.supplier_project_id==b}),this.groupCreatorRenderCurrentProjects()}if(this.by_team){var b=$(a.target).attr("data-id");this.new_group=_.reject(this.new_group,function(a){return a.user_id==b}),this.groupCreatorRenderCurrentProjects()}},createGroup:function(){var a=this,b="";if(this.by_group){var c=_.map(this.new_group,function(a){return{name:a.name,supplier_project_id:a.supplier_project_id,color:a.color}}),d=[],e="group",f="";b=$("#create-group-name").val()}else{var d=_.map(this.new_group,function(a){return{name:a.name,id:a.id,type:a.type}}),c=[],e="group",f="team";b=$("#create-team-name").val()}var g={name:b,type:e,subtype:f,supplier:"asana",projects:c,users:d,workspace:{id:this.workspace_id}};return 0==g.name.length||0==g.projects.length&&0==g.users.length?void alert("Project name can't be empty and you must include at least 1 element"):(App.Instances.ProjectsCollection.create(g,{success:function(){a.populateGroups(),a.render()}}),$(".projects",this.el).html(""),this.new_group=[],$("#import-projects-content").show(),$("#create-group").hide(),void $("#create-team").hide())},cancelCreateGroup:function(){this.new_group=[],$("#import-projects-content").show(),$("#create-group").hide(),$("#create-team").hide()}}),App.Views.SupplierProjectSingle=Backbone.View.extend({tagName:"li",className:"supplier-project",initialize:function(a){},events:{"click .btn.btn-success":"addProject","click .btn.btn-danger":"removeProject"},render:function(){var a;switch(this.model.get("type")){case"project":var b='<i class="fa fa-list-alt fa-fw"></i> ';break;case"workspace":var b='<i class="fa fa-user fa-fw"></i> ';break;case"group":if("team"==this.model.get("subtype"))var b='<i class="fa fa-users fa-fw"></i> ';else var b='<i class="fa fa-folder fa-fw"></i> '}if(a="",$(this.el).append($('<a href="javascript:void(0);">'+b+this.model.get("name")+a+"</a>")),"project"!=this.model.get("type")&&"workspace"!=this.model.get("type")||"team"==this.model.get("subtype")||(this.model.get("connected")?$("a",this.el).prepend($("<button class='pull-right btn btn-danger btn-mini'>Disconnect</button>")):$("a",this.el).prepend($("<button class='pull-right btn btn-success btn-mini'>Connect</button>"))),"group"==this.model.get("type")||"workspace"==this.model.get("type")&&"team"==this.model.get("subtype")){var c=_.pluck(this.model.get("projects"),"name").join(", "),d=_.pluck(this.model.get("users"),"name").join(", ");$("a",this.el).prepend($("<button class='pull-right btn btn-danger btn-mini'>Delete group</button>")),"group"==this.model.get("type")?$(this.el).append($("<div class='muted small-group-list'>"+c+"</div>")):$(this.el).append($("<div class='muted small-group-list'>"+d+"</div>"))}return this},addProject:function(){var a=this;App.Instances.ProjectsCollection.create(this.model.toJSON(),{success:function(b){a.model.set({id:b.get("id")})}}),a.model.set({connected:!0})},removeProject:function(){App.Instances.ProjectsCollection.get(this.model.get("id")).destroy(),this.model.set({connected:!1}),this.model.unset("id"),"group"==this.model.get("type")&&this.model.collection.remove(this.model)}}),App.Views.Prompt=Backbone.View.extend({tagName:"div",className:"modal hide",template:JST.prompt,types:{small:{width:"275px",marginLeft:"-137px"},big:{width:"750px",marginLeft:"-375px"},xl:{width:"1050px",marginLeft:"-525px",top:"5%"}},initialize:function(a){var b=this;a=a||{},this.callback=a.callback,this.cancelCallback=a.cancelCallback||function(){},this.fill=a.fill,$(this.el).html(this.template()),a.template&&$(".modal-body",this.el).html(a.template()),$("body").append(this.el),a.type&&this.types[a.type]&&$(this.el).css(this.types[a.type]),$(this.el).modal({backdrop:"static"}),a.afterRender&&setTimeout(function(){_.bind(a.afterRender,b)()},0)},events:{"click .btn-success":"success","click .btn-close":"cancel"},success:function(){var a=_.bind(this.fill,this)();this.callback(a),this.closePrompt()},cancel:function(){this.cancelCallback(),this.closePrompt()},closePrompt:function(){$(this.el).modal("hide"),this.close()}});